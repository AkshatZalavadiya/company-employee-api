# Company & Employee Data Integration API

A Python Flask application that provides an API for uploading employee data from CSV or Excel files and storing it in a SQLite database. The app establishes a one-to-many relationship between Companies and Employees, ensuring efficient and **idempotent** data insertion (uploading the same file multiple times will not create duplicates).

## Features

- **File Upload:** Accepts both `.csv` and `.xlsx` files.
- **Database:** Uses SQLite for simplicity and portability.
- **Efficient Inserts:** Bulk operations insert data much faster than row-by-row inserts.
- **Idempotency:** Prevents duplicate companies and employees by checking existing records.
- **Structured Code:** Follows Flask app factory and blueprint patterns for scalability.
- **Serialization:** Database models can be converted to JSON for clean API responses.

## Project Structure

```
/<PROJECT ROOT>
│-- main.py             # Main script to start the application.
|
│-- app/                # Main application package.
|   │-- __init__.py     # Initializes Flask app & extensions (Application Factory).
│   │-- models.py       # SQLAlchemy models (Company, Employee).
│   │-- routes.py       # API routes via Flask Blueprint.
│
│-- instance/           # Auto-generated by Flask for the database.
│   |-- company_data.db # SQLite database file.
```

## Setup and Installation

### Prerequisites

- Python 3.8+
- `pip` for package management

### 1. Clone the Repository

First, get the code on your machine. (Skip if you already have the files.)

### 2. Create a Virtual Environment

It's **highly recommended** to use a virtual environment.

```bash
# Create a virtual environment
python -m venv venv

# Activate the virtual environment
# On Windows:
venv\Scripts\activate
# On macOS/Linux:
source venv/bin/activate
```

### 3. Install Dependencies

```bash
pip install Flask Flask-SQLAlchemy pandas openpyxl
```

### 4. Run the Application

```bash
python main.py
```

You should see output similar to:

```
 * Serving Flask app 'app'
 * Debug mode: on
 * Running on http://0.0.0.0:5000
```

API will be available at: [http://127.0.0.1:5000](http://127.0.0.1:5000)

## API Endpoints

All endpoints are prefixed with `/api`.

### 1. **Upload Data**

- **URL:** `/api/upload`
- **Method:** `POST`
- **Description:** Upload a `.csv` or `.xlsx` file with employee data.
- **Form Data:** `file` — the data file to upload

**Example (cURL):**

```bash
curl -X POST -F "file=@/path/to/your/employees.csv" http://127.0.0.1:5000/api/upload
```

**Success Response (201):**

```json
{
  "message": "File processed. Inserted 50 new employees. Skipped 0 existing employees."
}
```

**Error Response (400/500):**

```json
{
  "error": "No file part in the request"
}
```

### 2. **Get All Companies**

- **URL:** `/api/companies`
- **Method:** `GET`
- **Description:** Retrieve all companies & employee count

**Example (cURL):**

```bash
curl http://127.0.0.1:5000/api/companies
```

**Success Response (200):**

```json
[
  {
    "employee_count": 5,
    "id": 1,
    "name": "IT_PROG"
  },
  {
    "employee_count": 2,
    "id": 2,
    "name": "HR_REP"
  }
]
```

### 3. **Get All Employees**

- **URL:** `/api/employees`
- **Method:** `GET`
- **Description:** Retrieve all employees, including their details

**Example (cURL):**

```bash
curl http://127.0.0.1:5000/api/employees
```

**Success Response (200):**

```json
[
    {
        "company_name": "AD_PRES",
        "department_id": 10,
        "first_name": "Steven",
        "id": 100,
        "last_name": "King",
        "manager_id": 109,
        "phone_number": "515.123.4567",
        "salary": 24000.0
    },
    {
        "company_name": "AD_VP",
        "department_id": 11,
        "first_name": "Neena",
        "id": 101,
        "last_name": "Kochhar",
        "manager_id": 110,
        "phone_number": "515.123.4568",
        "salary": 17000.0
    }
]
```

## Notes

- Ensure the uploaded file format matches `.csv` or `.xlsx`.
- Database is auto-created in the `instance/` directory as `company_data.db`.
- Uploading the same file multiple times is safe — no duplicate entries will be created.

**Happy coding!**